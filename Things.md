title:基于数学形态学的心电信号预处理和QRS波形检测
author:胡归
Logo:true
[title]

##摘要
心血管疾病是导致全世界人口死亡的首要原因，这种情况在除了非洲以外的其他国际和地区同样存在。心电是心脏活动过程中产生的生物电信号在体表的反映，能客观的映射出心脏的生理状态。动态心电图出现以来，心电的数据量急剧增加，传统方法由医生的手工分析已经不太现实。心电信号的自动分析技术得到很大发展，现在市场上已经出现多种心电自动分析软件和便携式心电监护设备。  
心电信号幅度小，频率低，采集信号时干扰严重，因此心电信号的滤波预处理是波形特征提取的前提。当然预处理也会使心电信号有用信号丢失一部分，从而直接影响心电信号自动分析的结果。  
基线漂移噪声是心电噪声中的主要成分，因此矫正基线漂移是心电信号预处理的重要一步。矫正ECG信号中基线漂移的方法包括小波变换、曲线拟合以及FIR和IIR滤波方法，但因计算量过大、受实时性特点影响和截止频率影响，矫正的效率不高。本文提出数学形态滤波器的方法，根据心电信号的几何特征设计参数。经验证取得良好效果。  
QRS波群作为心电图信号最为明显的特征，不仅包含心室肌收缩等重要心脏生理信息，而且检测QRS波群也是检测其他波形的前提。本文采用一种自适应差分阈值的方法来检测QRS波群，该方法通过心电信号的特征进行自适应学习，获取的阈值作为标准来检测R波。使得检测准确性受基线漂移和R波幅度影响较小。  
**关键词：**心电信号；滤波；数学形态学；QRS波群；差分；阈值；自适应
#1 绪论
##1.1研究背景与意义
当今社会生活节奏加快，生活工作压力也与日俱增，出现了各种威胁人类健康的疾病，其中心血管疾病成为威胁人类健康最主要的因素，并且发病率逐年上升。世界卫生组织公布一项数据显示，2013年心血管疾病共夺走1730万条生命，占总死亡人数的31.0%，比起1990年的1230万（总死亡人数的25.8%）提升了不少。心血管疾病(cardiovascular disease)是指关于心脏或血管的疾病，又称循环系统疾病。很多心血管疾病就是没有及时发现病变，耽误治疗而导致死亡。  
心电图检查因其方法简单，诊断可靠，对病人无损害等优点，在心脏病的诊断中有着极其重要的作用。心电图检查也是临床上诊断心血管疾病的主要方法，随着电子计算机的发展，利用计算机对ECG信号进行检测和分析有效的提高了诊断效率，减少医生诊断时主观因素的影响。实时的心电特征值检测在心电图机甚至手术室、ICU都会有很重要的应用。随着移动互联网时代的来临，可用于数据采集的便携式可穿戴设备也可以采集心电数据，在设备上甚至服务器云端都可以用检测算法来分析数据，做到实时、高效。在心脏病等心血管疾病发病前，心电信号是有明显异常的，如果这些异常能被检测算法提前检测出来，做出预警，那么对于心脏病的抢救具有巨大的积极意义。
##1.2国内外研究状态分析
1903年，荷兰医生、生理学家埃因托芬发明了弦线式检流计，从而带来了心电图历史上的第一次突破。埃因托芬把心电图中的一系列波分别命名为P波，Q波，R波，S波和T波，并且描述了一些心血管系统疾病的心电图特点。为了表彰他的此项发现，他于1924年获得诺贝尔医学与生理学奖。  
虽然我们今天仍然在使用那个时代的理论来分析心电图，但是近年来心电描记术领域已经出现了微小的进展。比如，心电记录仪器已经从实验室中的笨重的设备演变成了今天非常便携的装置，并且计算机心电图分析也参与其中。  
###1.2.1 心电信号预处理的研究现状
一般而言，正常人的心电信号幅度为10uV~5mV，频率在0.15Hz~150Hz之间，其中90%的心电信号能量集中在0.25Hz~35Hz之间。要获得心电信号很不容易，不仅仅是因为心电信号的强度小、频率低，而且各种类型的噪声会包含在心电信号的波形中。这些噪声包含肌肉噪声，由于探测电极的移动造成的人为噪声，电源线的干扰，基线漂移和T波高频类似于QRS复合体。  
基线漂移是人的呼吸运动，还有电极在皮肤上的轻微移动移动所引起的，频率一般低于5Hz。基线漂移能够直接影响心电信号的上下位置，给心电信号在图纸上的打印和对心电图的直接诊断带来麻烦。由于这种数据的不确定性，不适用大多数的QRS波检测算法。还有工频干扰是用电设备产生的干扰，其频率与环境中的交流电的频率一致，欧美地区一般为60Hz；在我国和其他国家地区的频率为50Hz。除此之外还有一些电极的接触不良或者脱落、剧烈运动等造成的干扰。有一种方法是利用数字滤波器，它能减弱这些噪声的影响，因此可以提高信噪比。在许多文献的提出的QRS检测器中，对于噪声的过滤正在逐步的加以重视。   
为了去除心电信号的噪声干扰，国内外研究人员做出来大量的工作，涌现出许多方法，比如经典的数字滤波技术，自适应滤波技术、小波变换、数学形态学、神经网络及独立分量的分析等。从这些常用的方法比较来看，经典滤波器的算法简单，容易实现，但其截止频率固定，去噪不灵活。特别是FIR滤波器中，10Hz的通带对于算法有很大的计算量；IIR滤波器对原始数据有一定的改变。自适应滤波技术通过对传统的滤波器技术进行改进，它能够根据噪声频率的变化自适应的调节来逐步逼近最优值，弥补了传统滤波器的截止频率固定的不足。这种滤波方法的缺陷是需要一个参考信号，但是参考信号不容易得到。神经网络法需要学习训练，样本的选取需要有很好的代表性。近年来，小波理论也得到了不断完善和发展，基于小波变换的去噪和检测得到广泛的运用。小波变换阈值去噪法是根据信号与噪声的频谱特性的不同进行滤波，能够较好的去除噪声并且保持心电信号波形不失真，但计算量过大是它的一个缺点。  
数学形态学是一种基于集合理论、格论和拓扑学基础上的图像分析学科，是数学形态学图像处理的基本理论。在滤除基线漂移的过程中，主要用到的运算为腐蚀和膨胀，开运算和闭运算。数学形态学最基本的概念是结构元素，它本身具有一定形态（如点、线段和圆等），相当于一个探针，不断移动进行匹配。在数据量不大的情况下，能够快速彻底的消除基线漂移。
###1.2.2 QRS波群检测的研究现状
心电图特征值的精确识别，为医生诊断任何心脏疾病以及心律失常的分类提供有用信息。如今QRS波的检测已有多种方法，总的来说，这些方法都已经运用在实时检测心电图波峰中。这些措施包括数字滤波器、模版匹配、差分法、小波变换和神经网络。  
20世纪七八十年代以来，Willis J. Tompkins教授所做的工作具有开创性意义，他提出一种实时检测心电QRS波算法具有很大影响。在这之后西安交通大学的郑崇勋教授等使用小波变换检测心电特征值的方法，也是一种主流的检测方法。
数字滤波器法是由线性数字滤波、非线性变换和决策算法三个部分组成。首先用一组数字滤波器滤除分析对象以外的信息、达到抑制噪声干扰的目的，以便于提取出QRS波特特征的信息。通常的做法是采用带通滤波，提高5～30Hz频率范围内信号的分量，使QRS波群的能量得到加强。然后采用阈值判断、斜率判断等方法对特征点进行判断，实现检测R波的目的，并采取一些补偿策略提高检测的准确度。采用滤波器方法的缺点是容易受到噪声干扰，且准确度有待提高。
人工神经网络(ANN，Artificial Neural Network)是近年来迅速发展的一种新型计算机和人工智能技术。它能够模拟人脑机理和功能的，具有鲁棒性、非线性、高度并行性和自组织适应性等基本特性。人工神经网络是一种自适应非线性预测器，其基本原理是根据过去的采样点来预测当前的采样点。但是它需要大量的学习训练，这个过程一般要花费较多的时间，而且训练的样本要具有一定的代表性，实施起来有一定困难。而且对于心电QRS波群检测来说，不同的个体的波形形态差比较大，这样学习和训练的样本量要很大，而且样本的选取要有足够好的代表性。随着科学技术的进步，在心电信号特征值检测领域，神经网络检测方法的潜力无疑是最大的。  
还有模版匹配法，心电信号可以看作类周期信号，利用心电信号的这一特性，可以将QRS波群近似认为固定的模板。其原理是把ECG信号与预先存储的波形模板逐点比较，当两者的耦合度达到指定的阈值时，认为检测到ORs波群。该方法计算量较大，当使用的模版为多个时，需要逐一计算。另外如果被检者的心电波形与模板中存储样本的形态相差很大，易造成QRS波群漏检。  
电子计算机技术的发展使得心电信号检测算法在时间复杂度、空间复杂度上没有较大的限制，但是科学研究工作者们对于检测算法程序能够运行得更快，体积更小的追求从未停止。  
##1.3 本文的主要内容
论文的安排如下：  
第1部分，首先简述了心电自动分析技术的研究背景和意义，对该领域研究的现状，发展方向做简要的概括。也对本课题的的主要研究内容做简单介绍。  
第2部分，本部分介绍心电信号的产生机理和波形特征，常用的数据库，已经本文要用到的MIT-BIH数据库及Windows平台下的开发工具包WFDB；再介绍本课题的开发工具Visual C++ 6.0。  
第3部分，先介绍数学形态学的基本理论和方法，然后运用形态学理论滤除心电信号的基线漂移，最后做实验仿真及分析。
第4部分，采用自适应差分阈值发检测R波,然后利用已经检测出来的R波检测Q波和S波，做准确率统计和数据分析。
第5部分，结论与展望。附录列出关键代码。引用文献。  
#2 基本理论知识简介  
##2.1 心电信号的产生和心电图  
在每次心跳心肌细胞去极化的时候会在皮肤表面引起很小的电学改变，这个小变化被心电图记录装置捕捉并放大即可描绘心电图。在心肌细胞处于静息状态时，心肌细胞膜两侧存在由正负离子浓度差形成的电势差，去极化即是心肌细胞电势差迅速向0变化，并引起心肌细胞收缩的过程。在健康心脏的一个心动周期中，由窦房结细胞产生的去极化波有序的依次在心脏中传播，先传播到整个心房，经过“内在传导通路”传播至心室。如果在心脏的任意两面放置2个电极，那么在这个过程中就可以记录到两个电极间微小的电压变化，并可以在心电图纸或者监视器上显示出来。心电图可以反应整个心脏跳动的节律，以及心肌薄弱的部分。  
心电图就是一种经胸腔的以时间为单位记录心脏的电生理活动，并通过皮肤上的电极捕捉并记录下来的诊疗技术。这是一种无创性的记录方式。一个完整的心动周期心电图如图2-1所示。
![](https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/SinusRhythmLabels.svg/1024px-SinusRhythmLabels.svg.png)
*图2-1 正常窦性心律心脏的心电图*  
从图2-1可以看到一个完整的心动周期包括一个P波，一个QRS波群和一个T波，以及在50%~75%的心电图中可能见到U波。心电图的基线被称为等电势线。一般情况下等电势线在心电图中是指T波后P波前的那一段波形。下表将详细描述各波形及时间间隔的定义及特征：  
*表2-1 心电图中常见波形的具体描述*  

|名称|描述|时长|
|:------:|:----------------------------:|:-------:|
|RR间期|相邻两个R波相隔的时间可以反应心率。静息状态下心率在60bpm到100bpm之间。|0.6~1.2s|
|P波|在正常的心房除极过程中，心电向量从窦房结指向房室结。除极由右心房至左心房。这个过程在心电图上形成了P波。|80ms|
|PR间期|PR间期指从P波开始到QRS波群开始的时间。PR间期反映了电冲动由窦房结发出，经房室结传入心室引起心室除极所需的时间。所以，PR间期可以很好的评估房室结的功能。|120~200ms|
|PR段| 	PR段连接了P波和QRS波群，代表了心电冲动由房室结传到希氏束、左右束支及浦野肯纤维的过程。这个过程中心电冲动并不直接引起心肌收缩，而只是其向心室传导的一个过程，所以在心电图上显示一个平直段。PR段对于临床诊断非常重要。|50~120ms|
|QRS波群|QRS波群反映了左右心室的快速去极化的过程。由于左右心室的肌肉组织比心房发达，所以QRS波群比P波的振幅高出很多。|80~120ms|
|J点 |	J点是QRS波群结束和ST段的开始的位置。J点用于ST段抬高或者压低的参照点。 |	N/A|
|ST段 |	ST段连接QRS波群与T波，代表心室缓慢复极化的过程。它位于等电势线上。 	|80~120ms|
|T波 |	T波代表心室快速复极化的过程，从QRS波群起始处到T波最高点这段时间称为心脏的绝对不应期，而T波的后半段则称为相对不应期（又称易激期）。. |160ms|
|ST间期 |J点到T波结束时的时间 |320ms|
|QT间期 |QT间期是QRS波群开始到T波结束时的时间。QT间期过长是室性心动过速的危险因子之一，可能引起猝死。QT间期受心率变化较大，所以采用QTc来消除心率影响。|300~430ms，Qtc:≤440ms|
|U波 |并不能经常看到，振幅很低，跟随T波后出现。产生机制不清楚。|  
ECG是测量和诊断异常心脏节律的最好的方法,其是诊断心电传导组织受损时心脏的节律异常以及由于电解质平衡失调引起的心脏节律的改变。在心肌梗死（MI）的诊断中，ECG可以特异性的分辨出心肌梗死的区域（但并不是心脏所有区域的心电活动改变都可以被ECG记录到）。ECG并不能可靠的评估心脏泵血能力，这通常由超声心动图或者核医学手段来完成。某些情况下，正常ECG图像的病人却可能会出现心脏停搏（一种叫做心电机械分离的情况下）。
##2.2 常用心电数据库的介绍
心电数据库是医学数据库的一个重要组成部分，具有重要的研究价值，更重要的是可以作为心电自动分析技术的评价标准。一个专业型的数据库需建立严格的标准（诊断标准、分类标准及仪器设备标准）和一定的技术要求。心电数据库的入库资料要经过临床证实和专家小组的标记、分类、诊断，以确保其可靠性和准确性。心电数据库也常被用作评价市场上心电分析仪器的性能。  
当今国际上公认的权威心电数据库有三个，分别是美国麻省理工学院提供的MIT-BIH数据库，美国心脏学会的AHA数据库和欧洲CES心电数据库。其中MIT－BIH使用最广泛。  
1. 麻省理工学院MITBIH数据库  
自1975年，麻省理工学院和波士顿的贝斯以色列医院（现在是贝斯以色列女执事医疗中心）开始研究心律失常分析及相关学科，通过努力研究，第一个成果就是MIT-BIH心律失常数据库，并在1980年完成并发布。这个数据库是第一个提供一套标准的测试材料来评估心律失常相关检测器，它不仅实现的原来的目标也被世界范围内的500多个研究机构用作心脏动态的基础研究。  
MIT-BIH心律失常数据库含有提取的48小时2通道的动态心电图记录，包含麻省理工学院心律失常实验室自1975年到1979年的47项研究。一组随机的4000人24小时的动态心电图记录来自波士顿的贝斯以色列医院的混合人种中的住院病人（约占60%）和门诊病人（约占40%），这些记录最终形成23个记录。剩下的25个记录是来自同一的样本，但是是这些样本中不同寻常的记录，它在临床的心律失常上具有显著的特性，且这些特性不会在小样本随机采样中轻易的显现出来。  
这些记录每通道数字化为360采样点每秒，拥有11位的分辨率和超过10mV的范围。两个或多个心脏病专家独立的注释了每一个记录。分歧得到解决后，这些记录形成一个数据库，它可以被计算机读取每一个心跳的注释（大约110000个注释）。自1999年9月George B. Moody建立[http://www.physionet.org/](http://www.physionet.org/ "http://www.physionet.org/")网站以来，MIT-BIH心律失常数据库已经被免费的提供。  
数据库中包含48个记录，每个记录包含2个导联，且时间都长达30分钟。导联的设置如下：第一通道采用校正的肢体II导联（MLII，记录102和104是校正的V5导联）;第二通道通常采用校正的V1导联（有时是V2，V5导联，其中一个是W导联）。  
MIT-BIH使用了自定义的存储格式，一个记录包含三个文件：
(1). 头文件，扩展名为.hea，存储方式为ASCII吗字符，可直接用记事本等文件打开。头文件保存了信号的格式、采样率、长度，以及有关的记录信息，如采集地，病人年龄、病情描述、用药细节等等。下面已100.hea文件为例：  
		100 2 360 650000  
		100.dat 212 200 11 1024 995 -22131 0 MLII  
		100.dat 212 200 11 1024 1011 20052 0 V5  
		# 69 M 1085 1629 x1  
		# Aldomet, Inderal  
包含的内容为100号记录、2个通道、360Hz采样和650000个采样点；212格式存储（每三个字节存两个信号值），信号增益为200ADC units/mV，ADC分辨率为11位，基线1024，两个信号的第一采样点分别为995和1011，-22131和20052分别为65万个采样点的校验数。最后两行为患者信息和用药情况。  
(2). 数据文件,扩展名为.dat，按二进制存储，每三个字节存储两个数，1个数12bit.包含两个通道的信号，含信号0和信号1。100号记录的16进制数据分布如图2-2。  
![](http://i.imgur.com/Ctr3ISt.png)  
*图2-2 100.dat数据文件16进制数据分布*  
按照“212”的格式，从第一字节读起，每三个字节（24 位）表示两个值，第一组为“E3 33 F3”,两个值则分别为0x3E3和0x3F3转换为十进制分别为995和1011,转化为毫伏分别为-0.145mV和-0.065mV。
(3). 注释文件,以.atr为扩展名，按二进制存储.记录了心电专家对相应的心电信号的诊断信息，主要包含每次心搏节律发生的时刻和类型,以及信号质量的分析结果。图2-3为100号记录的注释文件16进制数据分布。  
![](http://i.imgur.com/KrnkcEa.png)   
*图2-3 100.atr注释文件16进制数据分布*



